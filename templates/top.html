{% extends "layout.html" %}
{% block css %}
<link rel="stylesheet" href="/static/top/css/page.css" type="text/css" />
{% endblock %}

{% block content %}
<section class="hero is-medium is-primary is-bold">
  <div class="hero-body">
    <div class="container">
      <div class="columns is-centered">
        <div class="column is-narrow">
          <h1 class="title is-1">
            能力シェア&nbspで&nbspかけがえのない体験を。
          </h1>
        </div>
      </div>
      <div class="columns is-centered">
        <div class="column is-narrow is-three-fifths">
          <div class="field has-addons">
            <div class="control" style="width:100%;">
              <input id="search-box" class="input" type="text" placeholder="キーワードを入力" tabindex="1" onchange="filter()">
            </div>
            <div class="control">
              <button class="button is-success" onclick="filter()" tabindex="2">
                絞り込み
              </button>
            </div>
          </div>  
        </div>
      </div>
    </div>
  </div>
</section>

<section id="main-contents" class="section">
  <div id="projects-list" class="container">

    <h2 class="title is-2">プロジェクト一覧</h2>
    <div class="columns is-multiline">
      {% for i in data %}
      <div id="{{ data[loop.index0]['prj_id'] }}" class="column is-4">
        <div class="card" onclick="location.href=`prj/show/{{ data[loop.index0]['prj_id'] }}`" style="cursor:pointer">
          <div class="card-image">
            <figure class="image is-16by9">
              <img src="https://unsplash.it/400/225?d={{ loop.index0 }}" alt="Placeholder image">
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-left">
                <figure class="image is-48x48">
                  <img src="https://placekitten.com/96/96?d={{ loop.index0 }}" alt="Placeholder image">
                </figure>
              </div>
              <div class="media-content">
                {% set leader = {"user_name": "N/A"} %}
                {% set outer_loop = loop %}
                <p class="subtitle is-6">プロジェクトリーダー</p>
                {% for j in data[outer_loop.index0]['members'] %}
                  {% if 'leader' == data[outer_loop.index0]['members'][loop.index0]['member_type'] %}
                    <p class="title is-4">{{data[outer_loop.index0]['members'][loop.index0]['user_name']}}</p>
                    {% set leader = data[outer_loop.index0]['members'][loop.index0] %}
                  {% endif %}
                {% endfor %}
              </div>
            </div>

            <div class="content">
              <p class="title is-4 fixed-height">{{ data[loop.index0]['name'] }}</p>
              <br>
              {% set start_date = data[loop.index0]['start_date'] %}
              {% set start_date = start_date if start_date else "not started" %}
              <time datetime="{{ start_date }}">{{ start_date }}</time>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}

    </div>
  </div>
</section>
{% endblock %}

{% block js %}
<script async src="/static/top/js/page.js"></script>
<script type="text/javascript" id="dataLoader">
  var data = {{data|safe}}
  document.querySelector('#dataLoader').remove()
</script>
{% endblock %}